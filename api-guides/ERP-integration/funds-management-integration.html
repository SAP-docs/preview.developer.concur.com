<!DOCTYPE html>
<html lang="en">

<head>
  


  <title> SAP Concur Developer Center | Funds Management Integration Guide</title>


<!-- Meta -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="The starting point for anyone interested in integrating with the SAP Concur platform that reaches 80 million end users.">
<meta name="author" content="">

<!-- Sitemap link -->
<link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml" />

<!-- Favicon -->
<link rel="shortcut icon" href="/assets/img/square-sap-favicon.png" type="image/png">

<!-- Adobe Analytics Global-->
<script src="https://assets.adobedtm.com/e1226b306979/aeb854337dc8/launch-85c98625c1e8.min.js" async></script>

<!-- Canonical link-->
<link rel="canonical" href="https://preview.developer.concur.com/api-guides/ERP-integration/funds-management-integration.html" data-proofer-ignore>

<!-- CSS Global Compulsory -->
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400">
<link rel="stylesheet" href="/assets/style.css">

<!-- CSS Implementing Plugins -->
<link rel="stylesheet" href="/assets/plugins/font-awesome/css/all.min.css">



<link rel="alternate" type="application/rss+xml" title="SAP Concur Developer Center RSS" href="/feed.xml" />

</head>

<body>


  <div class="wrapper page-option-v1">
    <div class="hidden-print">
  <nav id="header-navbar" class="navbar navbar-inverse hidden-print">
      <!-- Brand and toggle get grouped for better mobile display -->
      <div class="navbar-header col-6">
        <button type="button" class="navbar-toggle collapsed" style="color: white" data-toggle="collapse" data-target="#nav-collapse-1" aria-expanded="false">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="/">
          <img src="/assets/img/sap-concur-logo-white.png" alt="Logo">
          <div class="app-name">Developer Center</div>
        </a>
      </div>
      <!-- Collect the nav links, forms, and other content for toggling -->
      <div class="collapse navbar-collapse col-6" id="nav-collapse-1">
        <ul class="nav navbar-nav navbar-right" style="padding-top: 9px">
          <!-- Development -->
          <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" style="color: white" role="button" aria-haspopup="true">
              Development <span class="caret"></span>
            </a>
            <ul class="dropdown-menu multi-column three-column-menu">
              <div class="row">
                <div class="col-sm-4">
                  <ul class="multi-column-dropdown">
                    <li class="column-icon">
                      <span class="fa-stack fa-lg">
                        <i class="fas fa-circle fa-stack-2x"></i>
                        <i class="fas fa-map-marked-alt fa-stack-1x fa-inverse"></i>
                      </span>
                    </li>
                    <li class="column-title">About</li>
                    <li><a href="/getting-started.html">Getting Started</a></li>
                    <li><a href="/api-reference/authentication/getting-started.html">Authentication</a></li>
                    <li><a href="/platform/index.html">Platform</a></li>
                    <li><a href="/tools-support/deprecation-policy.html">API Deprecation</a></li>
                  </ul>
                </div>
                <div class="col-sm-4">
                  <ul class="multi-column-dropdown">
                    <li class="column-icon">
                      <span class="fa-stack fa-lg">
                        <i class="fas fa-circle fa-stack-2x"></i>
                        <i class="fas fa-book fa-stack-1x fa-inverse"></i>
                      </span>
                    </li>
                    <li class="column-title">Documentation</li>
                    <li><a href="/api-reference/">API Reference</a></li>
                    <li><a href="/api-explorer/">API Explorer</a></li>
                    <li><a href="/api-guides/">API Guides</a></li>
                    <li><a href="/event-topics/">Event Topics</a></li>
                  </ul>
                </div>
                <div class="col-sm-4">
                  <ul class="multi-column-dropdown">
                    <li class="column-icon">
                      <span class="fa-stack fa-lg">
                        <i class="fas fa-circle fa-stack-2x"></i>
                        <i class="fas fa-clipboard-list fa-stack-1x fa-inverse"></i>
                      </span>
                    </li>
                    <li class="column-title">UX Guidelines</li>
                    <li><a href="/manage-apps/go-market-docs/app-center-ux-guidelines-enterprise.html">Enterprise Applications</a></li>
                    <li><a href="/manage-apps/go-market-docs/app-center-ux-guidelines-consumer.html">User Connections</a>
                    </li>
                  </ul>
                </div>
              </div>
            </ul>
          </li>
          <!-- Partner Resources -->
          <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" style="color: white" aria-haspopup="true" aria-expanded="false">
              Partner Resources <span class="caret"></span>
            </a>
            <ul class="dropdown-menu">
              <li class="column-icon">
                <span class="fa-stack fa-lg">
                  <i class="fas fa-circle fa-stack-2x"></i>
                  <i class="fas fa-lightbulb fa-stack-1x fa-inverse"></i>
                </span>
              </li>
              <li class="column-title">Partner Resources</li>
              <li><a href="/manage-apps/app-certification.html">App Certification</a></li>
              <li><a href="/manage-apps/partner-applications.html">App Registration & Management</a></li>
              <li><a href="/manage-apps/redirect.html">Go to Market</a></li>
              <li><a href="https://www.concur.com/en-us/app-center" target="_blank">App Center</a></li>
              <li><a href="https://www.concursolutions.com/" target="_blank">Login to Concur</a></li>
            </ul>
          </li>
          <!-- Support -->
          <li
            class="dropdown">
            <a href="#" class="dropdown-toggle" style="color: white" data-toggle="dropdown" role="button" aria-haspopup="true">
              Support <span class="caret"></span>
            </a>
            <ul class="dropdown-menu multi-column two-column-menu">
              <div class="row">
                <div class="col-sm-6">
                  <ul class="multi-column-dropdown">
                    <li class="column-icon">
                      <span class="fa-stack fa-lg">
                        <i class="fas fa-circle fa-stack-2x"></i>
                        <i class="fas fa-question fa-stack-1x fa-inverse"></i>
                      </span>
                    </li>
                    <li class="column-title">Support</li>
                    <li><a href="/tools-support/support.html">Support Options</a></li>
                    <li><a href="https://open.concur.com/" target="_blank">Service Status</a></li>
                  </ul>
                </div>
                <div class="col-sm-6">
                  <ul class="multi-column-dropdown">
                    <li class="column-icon">
                      <span class="fa-stack fa-lg">
                        <i class="fas fa-circle fa-stack-2x"></i>
                        <i class="fas fa-bullhorn fa-stack-1x fa-inverse"></i>
                      </span>
                    </li>
                    <li class="column-title">Bulletin</li>
                    <li><a href="/tools-support/release-notes/index.html">Release Notes</a></li>
                  </ul>
                </div>
              </div>
            </ul>
          </li>
          <!-- Search -->
          <li>
            <a href="#" class="search">
              <span class="sr-only">Search</span>
              <i class="fas fa-search search-btn" style="color:white;"></i>
            </a>
            <div class="search-open">
              <div class="input-group animated fadeInDown">
                <form method="GET" action="/search.html" id="searchbox_000165422556797149853:qlbg8re_3tu">
                  <input value="000165422556797149853:qlbg8re_3tu" name="cx" type="hidden">
                  <input value="FORID:11" name="cof" type="hidden"> <!-- FORID values configure ad positions -->
                  <div class="input-group">
                    <label for="q" hidden>Search</label>
                    <input type="text" id="q" class="form-control" name="q" placeholder="Search">
                    <span class="input-group-btn">
                      <button type="submit" class="btn bright-blue">Go</button>
                    </span>
                  </div>
                </form>
              </div>
            </div>
          </li>
        </ul> <!-- /.navbar-nav -->
      </div> <!-- /.navbar-collapse -->
  </nav> <!-- /.navbar -->
</div>


    <div id="main-content"
         class="main-content">
      <div class="container-fluid content">
  <div class="row">
    <div id="left-navigation"
         class="col-md-2 left-navigation">
      







<ul class="list-group sidebar-nav-v1 hidden-print" id="sidebar-nav">





  
    <li class="list-group-item ">
      <a href="/api-guides/">Integration Guides</a>
    </li>

  



  

    

    

    

    <li class="list-group-item list-toggle ">
      <a data-toggle="collapse" data-parent="#sidebar-nav" href="#collapse-attendees">
        Attendees
      </a>
      <ul id="collapse-attendees" class="collapse ">
        
          <li >
            <a href="/api-guides/attendees/external-attendees-to-expense-entries.html">Expense - Associating External Attendees to Expense Entries</a>
          </li>
        
      </ul>
    </li>

  



  

    

    

    

    <li class="list-group-item list-toggle ">
      <a data-toggle="collapse" data-parent="#sidebar-nav" href="#collapse-authentication">
        Authentication
      </a>
      <ul id="collapse-authentication" class="collapse ">
        
          <li >
            <a href="/api-guides/authentication/concur-get-refresh-token/concur-get-refresh-token.html">Tutorial 1. Create Tokens Required for SAP Concur API Access</a>
          </li>
        
          <li >
            <a href="/api-guides/authentication/concur-refresh-token-management/concur-refresh-token-management.html">Tutorial 2. Refresh Token Management Automation</a>
          </li>
        
          <li >
            <a href="/api-guides/authentication/concur-calling-apis/concur-calling-apis.html">Tutorial 3. Call SAP Concur APIs Using A Multiple Use Bearer Token</a>
          </li>
        
      </ul>
    </li>

  



  
    <li class="list-group-item ">
      <a href="/api-guides/e-receipts.html">eReceipts Integration</a>
    </li>

  



  
    <li class="list-group-item ">
      <a href="/api-guides/ess-guide.html">Event Subscription Service v4 Guide</a>
    </li>

  



  

    

    

    

    <li class="list-group-item list-toggle ">
      <a data-toggle="collapse" data-parent="#sidebar-nav" href="#collapse-expense">
        Expense
      </a>
      <ul id="collapse-expense" class="collapse ">
        
          <li >
            <a href="/api-guides/expense/cost-object-workflow-integration.html">Cost Object Workflow Integration</a>
          </li>
        
          <li >
            <a href="/api-guides/expense/deeplink-url.html">Deeplink URL</a>
          </li>
        
          <li >
            <a href="/api-guides/expense/mexico-cfdi-integration.html">Mexico CFDI Integration Guide</a>
          </li>
        
      </ul>
    </li>

  



  

    

    

    

    <li class="list-group-item list-toggle ">
      <a data-toggle="collapse" data-parent="#sidebar-nav" href="#collapse-erp-integration">
        ERP Integration
      </a>
      <ul id="collapse-erp-integration" class="collapse ">
        
          <li >
            <a href="/api-guides/ERP-integration/erp-integration.html">ERP Integrations</a>
          </li>
        
          <li >
            <a href="/api-guides/ERP-integration/posting-via-financial-integration-service.html">Financial Posting via Financial Integration Service</a>
          </li>
        
          <li >
            <a href="/api-guides/ERP-integration/posting-via-extracts.html">Financial Posting via Extracts</a>
          </li>
        
      </ul>
    </li>

  



  

    

    

    

    <li class="list-group-item list-toggle ">
      <a data-toggle="collapse" data-parent="#sidebar-nav" href="#collapse-invoice">
        Invoice
      </a>
      <ul id="collapse-invoice" class="collapse ">
        
          <li >
            <a href="/api-guides/invoice/payment-provider-integration.html">Payment Provider Integration - paying customers' invoices</a>
          </li>
        
      </ul>
    </li>

  



  
    <li class="list-group-item ">
      <a href="/api-guides/preproduction-testing.html">Testing App Center Partner Applications</a>
    </li>

  



  

    

    

    

    <li class="list-group-item list-toggle ">
      <a data-toggle="collapse" data-parent="#sidebar-nav" href="#collapse-profile">
        Profile
      </a>
      <ul id="collapse-profile" class="collapse ">
        
          <li >
            <a href="/api-guides/profile/identity-search.html">Identity v4.1 Search Guide</a>
          </li>
        
      </ul>
    </li>

  



  

    

    

    

    <li class="list-group-item list-toggle ">
      <a data-toggle="collapse" data-parent="#sidebar-nav" href="#collapse-request">
        Request
      </a>
      <ul id="collapse-request" class="collapse ">
        
          <li >
            <a href="/api-guides/request/deeplink-url-request.html">Deeplink URL Integration</a>
          </li>
        
      </ul>
    </li>

  



  

    

    

    

    <li class="list-group-item list-toggle ">
      <a data-toggle="collapse" data-parent="#sidebar-nav" href="#collapse-tmc">
        TMC
      </a>
      <ul id="collapse-tmc" class="collapse ">
        
          <li >
            <a href="/api-guides/tmc/tmc-overview.html">TMC Guide Overview</a>
          </li>
        
          <li >
            <a href="/api-guides/tmc/itinerary-v1-guide.html">Guide to the Itinerary v1.0 API, TMC Edition</a>
          </li>
        
          <li >
            <a href="/api-guides/tmc/profile-v2-guide.html">Guide to the Profile v2.0 API, TMC Edition</a>
          </li>
        
          <li >
            <a href="/api-guides/tmc/receipts-v4-guide.html">Guide to the Receipts v4.0 API, TMC Edition</a>
          </li>
        
          <li >
            <a href="/api-guides/tmc/request-v4-guide.html">Guide to the Request v4.0 API, TMC Edition</a>
          </li>
        
      </ul>
    </li>

  



  

    

    

    

    <li class="list-group-item list-toggle ">
      <a data-toggle="collapse" data-parent="#sidebar-nav" href="#collapse-travel">
        Travel
      </a>
      <ul id="collapse-travel" class="collapse ">
        
          <li >
            <a href="/api-guides/travel/deeplink-integration.html">Deep Link Integration</a>
          </li>
        
          <li >
            <a href="/api-guides/travel/duty-of-care.html">Duty of Care</a>
          </li>
        
          <li >
            <a href="/api-guides/travel/get-itinerary.html">Itinerary - GET Itinerary & Trip Details</a>
          </li>
        
          <li >
            <a href="/api-guides/travel/new-itinerary-manual.html">Itinerary - Add a New Itinerary Manually</a>
          </li>
        
          <li >
            <a href="/api-guides/travel/itin-with-events.html">Itinerary - Business Travel Events</a>
          </li>
        
      </ul>
    </li>

  



  

    

    

    

    <li class="list-group-item list-toggle ">
      <a data-toggle="collapse" data-parent="#sidebar-nav" href="#collapse-user-provisioning">
        User Provisioning
      </a>
      <ul id="collapse-user-provisioning" class="collapse ">
        
          <li >
            <a href="/api-guides/user-provisioning/user-provisioning.html">User Provisioning</a>
          </li>
        
      </ul>
    </li>

  



  
    <li class="list-group-item ">
      <a href="/api-guides/vat-reclaim/vat-reclaim-guide.html">VAT Reclaim Integration</a>
    </li>

  



</ul>

    </div>
    <!--/col-md-3-->

    
      <div id="markdown-body"
           class="col-md-8 markdown-body">
        

        <h1 id="funds-management-integration-guide">Funds Management Integration Guide</h1>

<p>This guide describes an integration between SAP Concur Solutions and client ERP Encumbrance or Funds Management Modules. This integration will provide near real-time budget validation of funds. The integration leverages the Event Subscription Services with Concur Request and Financial Services APIs to provide bi-directional communication between a client’s SAP Concur entity and their ERP Encumbrance or Funds Management Module.</p>

<h2 id="limitations">Limitations</h2>

<p>This feature is only available to customers who have Concur Request and Concur Expense deployed in a Professional environment.</p>

<h2 id="funds-management-workflow">Funds Management Workflow</h2>

<ol>
  <li>User creates Request, assigns hierarchical organization codes to expense items, clicks <strong>Submit</strong> to send to approver.</li>
  <li>The Request moves to the first step in the approval workflow <strong>Pending External Validation</strong>.</li>
  <li>Event Subscription Service is triggered.
    <ul>
      <li>Notification for event <code class="language-plaintext highlighter-rouge">statusChange.PENDING.ExternalValidation</code> is sent to the URL endpoint registered by the partner.</li>
    </ul>
  </li>
  <li>Partner’s application receives notification <code class="language-plaintext highlighter-rouge">statusChange</code> event notification that includes Request ID and link.</li>
  <li>Partner’s application calls Request v4 API to obtain details of Request.</li>
  <li>Partner’s Application conducts funds/budget validation in ERP System.</li>
  <li>Partner’s application either:
    <ul>
      <li>Approves Request</li>
    </ul>
    <ul>
      <li>Create Commitment in ERP System.</li>
      <li>Approves Request and sends back Commitment/Document ID.</li>
      <li>Request moves through the workflow approvals in Concur Request.
      * Rejects Request</li>
      <li>Sends Request back to the employee for revision with an informational comment.</li>
      <li>Funds Management workflow starts over when Request is re-submitted.</li>
    </ul>
  </li>
  <li>User creates Expense Report associated to the relevant Request.</li>
  <li>Expense Report completes approval workflow and is sent for Financial Posting.</li>
  <li>Partner’s application:
    <ul>
      <li>Deletes Commitment.</li>
      <li>Real Cost Posting to Funds or Grants.</li>
    </ul>
  </li>
</ol>

<h2 id="event-subscription-service">Event Subscription Service</h2>

<p>The <a href="/api-reference/common/ess/getting-started.html">Event Subscription Service (ESS)</a> implements Publish/Subscribe pattern using principles of Event Driven Architecture. When the Request event occurs, ESS sends that event to the configured endpoint with relevant information.</p>

<h3 id="delivery-model">Delivery Model</h3>

<p>It is important to remember that ESS doesn’t have an API that you can call for SAP Concur events, ESS delivers events to your endpoint. It uses an outbound callout where a public facing URL (web server hosted by you or your customer) provided by you is called. Please review the <a href="/api-reference/common/ess/getting-started.html#ess-delivery">ESS Delivery Model</a> for more details.</p>

<h3 id="access-control">Access Control</h3>

<p>ESS requires your application to have the proper authentication token and scopes. Required scopes are:</p>

<ul>
  <li>ESS API level scope: <code class="language-plaintext highlighter-rouge">events.topic.read</code> to access ESS API.</li>
  <li>Resource level scope: <code class="language-plaintext highlighter-rouge">travelrequest.write</code> to access <code class="language-plaintext highlighter-rouge">concur.request</code> topic and to be able to create subscriptions to that topic.</li>
</ul>

<p>Please review the <a href="/api-reference/common/ess/getting-started.html#access-control">ESS Access Control</a> section for more details.</p>

<h3 id="service-behavior">Service Behavior</h3>

<p>Please review the <a href="/api-reference/common/ess/getting-started.html#ess-behavior">ESS Service Behavior</a> section for ESS characteristics from the subscriber perspective.</p>

<h3 id="authentication">Authentication</h3>

<p>Please review the <a href="/api-reference/common/ess/getting-started.html#ess-authentication">ESS Authentication</a> section for a list of ways you can ensure that your endpoint is being accessed by our service, including our Public Key.</p>

<h3 id="endpoint-requirements">Endpoint Requirements</h3>

<p>It is important that you review the <a href="/api-reference/common/ess/getting-started.html#endpoint-requirements">Endpoint Requirements</a> section for a list of requirements your endpoint must meet.</p>

<h3 id="subscribing-your-endpoint">Subscribing Your Endpoint</h3>

<p>In order to subscribe to the relevant topic for your application <code class="language-plaintext highlighter-rouge">concur.request</code>, you must first obtain the necessary credentials (Application ID and Secret) from your SAP Concur Certification Project Manager (CPM).</p>

<ol>
  <li><a href="/api-reference/common/ess/subscription-management.html#ac-jwt">Authenticate</a>
    <ul>
      <li>The authentication is done by using an authentication token that represents the event subscriber. This can be obtained by calling the <a href="/api-reference/authentication/apidoc.html#client_credentials">Client Credentials grant</a> type using your OAuth 2.0 credentials. The authentication token generated by this grant will have a authentication token type of App where your Application ID is the subject of the token.</li>
      <li>For authorization, the application needs to contain the scope <code class="language-plaintext highlighter-rouge">events.topic.read</code> in order to access the ESS API. This scope will be inherited by the authentication token during the Client Credentials Grant, which is then checked by the ESS API.
<strong>This is the Token you will use to manage your subscriptions.</strong></li>
    </ul>
  </li>
  <li><a href="/api-reference/common/ess/subscription-management.html#get-topics">Browse available topics</a>
    <ul>
      <li>Before you create any subscription, you need to verify that you have sufficient access to the topic <code class="language-plaintext highlighter-rouge">concur.request</code>.</li>
      <li>If that request returns empty you need to get in touch with your SAP Concur CPM to set proper scopes to your application.</li>
    </ul>
  </li>
  <li><a href="/api-reference/common/ess/subscription-management.html#put-subscription">Create a Subscription</a>
    <ul>
      <li>Confirm your authentication token has the scope <code class="language-plaintext highlighter-rouge">events.topic.read</code> scope.</li>
      <li>Create a unique name (id) for your subscription. Subscription names are globally unique, and you will get an error if name is already taken.  Examples:</li>
    </ul>
    <ul>
      <li>public.partner.{Integration Name}.concur-request.dev</li>
      <li>public.partner.{Integration Name}.concur-request.qa</li>
      <li>public.partner. {Integration Name}.concur-request.prod
        <ul>
          <li>Set filter to .* (regexp syntax), you can use it later to filter out unwanted types of events.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="/api-reference/common/ess/subscription-management.html#get-subscription">Verify your Subscription</a>
    <ul>
      <li>You can <a href="/event-topics/index.html#verify-your-subscription">verify your subscription</a> to an event. You might notice that your subscription contains some parameters that you cannot modify for security reasons but can use them for troubleshooting purposes.</li>
    </ul>
    <ul>
      <li><code class="language-plaintext highlighter-rouge">applicationId</code> - identifies your application as an owner of that subscription.</li>
      <li><code class="language-plaintext highlighter-rouge">companyIds</code> - a list of UUIDs of companies that allowed your application to access their data, the process of connecting companies to your application is described later in this document.</li>
      <li>groups and scope - are used for complex access control scenarios.</li>
    </ul>
  </li>
</ol>

<h3 id="receiving-events">Receiving Events</h3>

<p>In order to begin receiving events for a customer’s entity, the customer must first enable your integration in the SAP Concur App Center.</p>

<h2 id="app-center-application">App Center Application</h2>

<h3 id="activation--connection">Activation / Connection</h3>

<p>Quick Connect is the process in which a customer connects their company’s SAP Concur instance to your application thus enabling your integration.</p>

<p>The landing page will facilitate the customer’s connection to your application. You should develop a web page that listens for an HTTP GET request from SAP Concur solutions, while adhering to the App Center <a href="/manage-apps/go-market-docs/app-center-ux-guidelines-enterprise.html">UX Design Guidelines</a>.  This guide includes requirements and recommendations to help ensure that our shared users have a positive experience.</p>

<h3 id="authentication-1">Authentication</h3>

<ol>
  <li>The connection flow begins from the SAP Concur App Center. A customer’s logged-in Company Administrator finds your App Listing and clicks the <strong>Connect</strong> button. Once the Administrator has accepted the terms &amp; conditions, the SAP Concur App Center will open a new window to your pre-defined redirect URI (referred to as your “Connect URI”).</li>
  <li>This is your landing page and it will be the first page the user sees upon redirect from SAP Concur solutions.</li>
  <li>The redirect URI will contain the following parameters:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">id</code>: Customer’s Unique Identifier (UUID) (Company Level).</li>
      <li><code class="language-plaintext highlighter-rouge">requestToken</code>:  Temporary Token used to obtain a full access token for a customer.</li>
      <li><code class="language-plaintext highlighter-rouge">userId</code>: Unique Identifier for user who clicked the <strong>Connect</strong> button.</li>
    </ul>
  </li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://{partner_redirect_URI}?id=8568a4cd-8ffc-49d6-9417-be2d69aa075f&amp;requestToken=5l85ae5a-426f-4d6f-8af4-08648c4b696b&amp;userId=9bdded51-00b8-4f84-8bef-6d3afe727007
</code></pre></div></div>

<ol>
  <li>When your application receives the redirect call, you should strip the <code class="language-plaintext highlighter-rouge">id</code> and <code class="language-plaintext highlighter-rouge">requestToken</code> values from the URI and use those on a POST request to the Concur Authorization service to obtain the official OAuth 2.0 <code class="language-plaintext highlighter-rouge">access_token</code> and <code class="language-plaintext highlighter-rouge">refresh_token</code> for the customer using the <a href="/api-reference/authentication/apidoc.html#password_grant">password grant</a>.</li>
  <li>When you receive the <code class="language-plaintext highlighter-rouge">access_token</code> you will also receive the elements below. Store them with the customer’s profile metadata:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">access_token</code>: Valid for only one hour. The <code class="language-plaintext highlighter-rouge">access_token</code> should be cached in memory and discarded after use.</li>
      <li><code class="language-plaintext highlighter-rouge">refresh_token</code>: Used to request a new <code class="language-plaintext highlighter-rouge">access_token</code>. Has a 6-month lifetime.</li>
      <li><code class="language-plaintext highlighter-rouge">refresh_expires_in</code>: This is Epoch time format, convert to UTC.</li>
      <li><code class="language-plaintext highlighter-rouge">geolocation</code>: To be used as the base URI for all subsequent API calls on behalf of the customer.</li>
      <li><code class="language-plaintext highlighter-rouge">id</code>: The customer’s unique identifier (UUID) which is returned as the <code class="language-plaintext highlighter-rouge">sub</code> element after <code class="language-plaintext highlighter-rouge">id_token</code> is decoded.
<strong>This is the Token you will use to make Request API calls for your customers.</strong></li>
    </ul>
  </li>
  <li>Along with the above elements, you will also receive the scopes associated with your application. Confirm the <code class="language-plaintext highlighter-rouge">travelrequest.write</code> scope is included.</li>
</ol>

<h3 id="receiving-events-1">Receiving Events</h3>

<p>Once the customer has enabled your application, you will begin receiving event notifications for Request Events.  The event notification payload includes the Request <code class="language-plaintext highlighter-rouge">id</code> and <code class="language-plaintext highlighter-rouge">href</code> attributes that you will need to make the subsequent calls to the Request APIs.</p>

<p><strong>Example of ESS Request Status Change Notification</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST https://{PartnerEndpoint}/api/ess
HEADERS: none
Body: JSON
{
  "id": "5d1f9624-7a1c-49a8-af53-a40bd1134bdb",
  "correlationId": "59cd7eb5-a193-4e2e-b367-32e5de313095",
  "eventType": "statusChange.PENDING.ExternalValidation",
  "topic": "concur.request",
  "timeStamp": "2020-07-23T13:16:19.83Z",
  "data": null,
  "facts": {
    "companyId": "2fced72e-6347-42e6-ba27-352bbe98696f",
    "role": "ExternalValidation",
    "workflowStepCode": "Q_EXTV",
    "isClosed": "false",
    "requestId": "33EK",
    "actingUserId": "24ff1596-9fd0-4f2b-8c0a-c445f4301f91",
    "id": "7E6C9EE209C60E488AF8367AC7B25452",
    "href": "https://us.api.concursolutions.com/travelrequest/v4/requests/7E6C9EE209C60E488AF8367AC7B25452",
    "userId": "24ff1596-9fd0-4f2b-8c0a-c445f4301f91",
    "status": "PendingExternalValidation"
  },
  "groups": null,
  "scopes": [
    "travelrequest.write"
  ]
}
</code></pre></div></div>

<h3 id="obtaining-request-data">Obtaining Request Data</h3>

<ol>
  <li>Get Request Details - Use the <a href="/api-reference/request/v4.endpoints.request-resources.html#request-resource-get">Get the content of an existing Request</a> call to obtain the Request details.  You will send the GET call to the <code class="language-plaintext highlighter-rouge">href</code> URI received in the Event Notification payload. The response will include the Expenses <code class="language-plaintext highlighter-rouge">id</code> and <code class="language-plaintext highlighter-rouge">href</code> attributes that you will need to obtain Expense data.</li>
  <li>Get Expected Expenses - Use the <a href="/api-reference/request/v4.endpoints.expected-expense-resources.html#get-content-expected-expense-resource">Get Expected Expense Content</a> call to obtain the content of the expected expenses. You will send the GET call for each expense received in the Get Request Details response.</li>
</ol>

<h3 id="initial-external-validation">Initial External Validation</h3>

<ol>
  <li>Your Application performs any of the following Funds Management actions:
    <ul>
      <li>Budget Checks</li>
      <li>Encumbrance</li>
      <li>Commitment Creation</li>
    </ul>
  </li>
  <li>Your application determines if Request gets sent to approver or back to employee.</li>
</ol>

<h3 id="request-workflow-action">Request Workflow Action</h3>

<p>Use the <a href="/api-reference/request/v4.endpoints.workflow-resources.html#Move-existing-request-in-approval-workflow">Workflow Resources</a> to move the Request in the approval workflow. Approval actions are:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">approve</code>: moves the Request to the next approval step.</li>
  <li><code class="language-plaintext highlighter-rouge">sendback</code>: rejects the Request and sends back to the employee, this action allows you to include a comment to the employee.</li>
</ul>

<h3 id="continued-external-validation">Continued External Validation</h3>

<p>Your application should monitor event notifications for Requests that you have approved until they complete approval workflow. Certain actions by users and/or approvers could cause the Request to re-start the approval workflow or be cancelled. Examples:</p>
<ul>
  <li>User recalls Request to edit information, requiring a re-submittal of Request.</li>
  <li>Approver (at any level of approval flow) rejects Request and sends it back to employee.</li>
  <li>User Cancels Request.</li>
  <li>Request events your application should monitor are:
    <ul>
      <li>Canceled: <code class="language-plaintext highlighter-rouge">statusChange.CANCELED</code></li>
      <li>Sent Back / Recalled: <code class="language-plaintext highlighter-rouge">statusChange.SENTBACK</code></li>
      <li>Approved: <code class="language-plaintext highlighter-rouge">statusChange.APPROVED</code></li>
    </ul>
  </li>
  <li>Possible Funds Management actions based on the above events include:
    <ul>
      <li>Encumbrance Creation</li>
      <li>Commitment Creation/Update</li>
      <li>Commitment Deletion</li>
    </ul>
  </li>
</ul>

<h3 id="financial-data-posting-and-feedback-loop">Financial Data Posting and Feedback Loop</h3>

<ul>
  <li>The ERP receives the posting data for the Concur Expense Report(s) linked to the Request via Financial Integration Service. See the <a href="./posting-via-financial-integration-service.html">Financial Posting via Financial Integration Service</a> guide for more information.</li>
  <li>For information on the various financial integration processes, see <a href="/api-reference/financial-integration/v4.financial-integration-service-use-cases.html">Financial Integration Service Use Cases</a>.</li>
</ul>

      </div>
      <!--/col-md-8-->
      
      <div id="markdown-toc"
           class="col-md-2 markdown-toc">
        <div class="markdown-toc-header">
    <h4>On this page</h4>
</div>
<div class="markdown-toc-content">
</div>

      </div>
      <!--/col-md-1-->
      
    </div>
    <!--/row-->
  </div>
  <!--/container-->

  <!-- TOCBOT -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.11.1/tocbot.min.js"></script>

<script>
  tocbot.init({
    // Where to render the table of contents.
    tocSelector: '.markdown-toc-content',
    // Where to grab the headings to build the table of contents.
    contentSelector: '.markdown-body',
    // Which headings to grab inside of the contentSelector element.
    headingSelector: 'h1, h2',
    // For headings inside relative or absolute positioned containers within content.
    hasInnerContainers: false,
  });
</script>


    </div>

    <footer class="hidden-print"
        id="footer">
  <div class="col-md-8 footer-copyright">
    <p>
      &copy;
      <script type="text/javascript">
        document.write(new Date().getFullYear());
      </script>
      All Rights Reserved.
      <a href="https://www.concur.com/en-us/privacy-policy">Privacy Policy</a> |
      <a href="/terms-of-use-2021.html">Terms of Use</a> |
      <a href="/tools-support/deprecation-policy.html">API Deprecation Policy</a> |
      <a href="/legal-disclosure.html">Legal Disclosure</a> |
      <a href="https://github.com/SAP-docs/preview.developer.concur.com/blob/main/src/api-guides/ERP-integration/funds-management-integration.markdown">Edit this page on GitHub</a>
    </p>
  </div>

  <!-- Social Links -->
  <div class="col-md-4 footer-social">
    <ul class="list-inline social-icons">
      <li>
        <a href="https://www.facebook.com/SAPConcur"
           target="_blank">
          <span class="sr-only">Facebook</span>
          <span class="fa-stack fa-lg">
            <i class="fas fa-circle fa-stack-2x"></i>
            <i class="fab fa-facebook-f fa-stack-1x fa-inverse"></i>
          </span>
        </a>
      </li>
      <li>
        <a href="https://www.linkedin.com/company/5822"
           target="_blank">
          <span class="sr-only">LinkedIn</span>
          <span class="fa-stack fa-lg">
            <i class="fas fa-circle fa-stack-2x"></i>
            <i class="fab fa-linkedin-in fa-stack-1x fa-inverse"></i>
          </span>
        </a>
      </li>
      <li>
        <a href="https://twitter.com/sapconcur"
           target="_blank">
          <span class="sr-only">Twitter</span>
          <span class="fa-stack fa-lg">
            <i class="fas fa-circle fa-stack-2x"></i>
            <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
          </span>
        </a>
      </li>
      <li>
        <a href="https://www.youtube.com/playlist?list=PLLNSVdjqNPVseaDkR5hSF4CDjnlLK7_nq"
           target="_blank">
          <span class="sr-only">Youtube</span>
          <span class="fa-stack fa-lg">
            <i class="fas fa-circle fa-stack-2x"></i>
            <i class="fab fa-youtube fa-stack-1x fa-inverse"></i>
          </span>
        </a>
      </li>
    </ul>
  </div>
  <!-- End Social Links -->
</footer>
<!--/.footer-->

  </div>
  <!--/wrapper-->

  <!-- JS Global Compulsory -->
<script type="text/javascript" src="/assets/plugins/jquery/jquery.min.js"></script>
<script type="text/javascript" src="/assets/plugins/jquery/jquery-migrate.min.js"></script>
<script type="text/javascript" src="/assets/plugins/bootstrap/js/bootstrap.min.js"></script>

<!-- Adobe Analytics Global-->
<script src="https://assets.adobedtm.com/e1226b306979/aeb854337dc8/launch-85c98625c1e8.min.js" async></script>

<!-- Swagger -->
<!-- <script src="/swagger-ui/lib/jquery-1.8.0.min.js" type="text/javascript"></script> -->



<script>
  var replacementURL = "preview.developer.concur.com/api-explorer-proxy";
</script>



<!-- JS Implementing Plugins -->
<script type="text/javascript" src="/assets/plugins/back-to-top.js"></script>
<!-- JS Page Level -->
<script type="text/javascript" src="/assets/js/app.js"></script>
<script type="text/javascript">
  jQuery(document).ready(function() {
    App.init();
  });
</script>

<script>
  var oHeader = document.getElementById("header-navbar");
  var oContent = document.getElementById("main-content");
  var oFooter = document.getElementById("footer");

  // Set content overall height
  var iNewHeight = oContent.offsetHeight - (oHeader.offsetHeight + oFooter.offsetHeight);
  var sHeight = "" + iNewHeight + "px";
  oContent.style.height = sHeight;

  // Set Triple component heights.
  // var oBreadcrumb = document.getElementById("breadcrumbs");
  var oLeftNav = document.getElementById("left-navigation");
  var oMDContent = document.getElementById("markdown-body");
  var oMDToc = document.getElementById("markdown-toc");
  var iViewWidth = Math.max(document.documentElement.clientWidth || 0, window.innerWidth || 0)

  // Widths are 2-8-2 or 2-10 if no MDToc
  var sWidth;
  if (iViewWidth < 989) {
    if (!!oLeftNav) {
      oLeftNav.style.height = 100;
      sWidth = "" + (window.innerWidth * 0.950) + "px";
      oLeftNav.style.maxWidth = sWidth;
    }
  } else {
    if (!!oLeftNav) {
      oLeftNav.style.height = sHeight;
      sWidth = "" + (window.innerWidth * 0.166) + "px";
      oLeftNav.style.maxWidth = sWidth;
    }
    if (!!oMDContent) {
      oMDContent.style.height = sHeight;
      if (!!oMDToc) {
        // 8 / 12
        sWidth = "" + (window.innerWidth *0.66) + "px";
        oMDContent.style.maxWidth = sWidth;
      } else {
        // 10 / 12
        oMDContent.style.maxWidth = window.innerWidth * 0.833;
        sWidth = "" + (window.innerWidth * 0.833) + "px";
        oMDContent.style.maxWidth = sWidth;
      }
    }
    if (!!oMDToc) {
      oMDToc.style.height = sHeight;
      sWidth = "" + (window.innerWidth * 0.166) + "px";
      oMDToc.style.maxWidth = sWidth;
    }
  }
</script>


</body>

</html>
